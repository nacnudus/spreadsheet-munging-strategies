<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9.3 US Crime | Spreadsheet Munging Strategies</title>
  <meta name="description" content="9.3 US Crime | Spreadsheet Munging Strategies" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="9.3 US Crime | Spreadsheet Munging Strategies" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9.3 US Crime | Spreadsheet Munging Strategies" />
  
  
  

<meta name="author" content="Duncan Garmonsway" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="vaccinations.html"/>
<link rel="next" href="toronto-transit-commission.html"/>
<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45097885-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45097885-10');
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>1</b> Setup</a>
<ul>
<li class="chapter" data-level="1.1" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>1.1</b> Packages</a></li>
<li class="chapter" data-level="1.2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tidyish.html"><a href="tidyish.html"><i class="fa fa-check"></i><b>2</b> Tidy-ish tables</a>
<ul>
<li class="chapter" data-level="2.1" data-path="tidy-clean.html"><a href="tidy-clean.html"><i class="fa fa-check"></i><b>2.1</b> Clean &amp; tidy tables</a></li>
<li class="chapter" data-level="2.2" data-path="almost-tidy-tables.html"><a href="almost-tidy-tables.html"><i class="fa fa-check"></i><b>2.2</b> Almost-tidy tables</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="almost-tidy-tables.html"><a href="almost-tidy-tables.html#transposed-headers-in-the-first-row-data-extends-to-the-right"><i class="fa fa-check"></i><b>2.2.1</b> Transposed (headers in the first row, data extends to the right)</a></li>
<li class="chapter" data-level="2.2.2" data-path="almost-tidy-tables.html"><a href="almost-tidy-tables.html#other-stuff-on-the-same-sheet"><i class="fa fa-check"></i><b>2.2.2</b> Other stuff on the same sheet</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="tidy-formatted-rows.html"><a href="tidy-formatted-rows.html"><i class="fa fa-check"></i><b>2.3</b> Meaningfully formatted rows</a></li>
<li class="chapter" data-level="2.4" data-path="tidy-formatted-cells.html"><a href="tidy-formatted-cells.html"><i class="fa fa-check"></i><b>2.4</b> Meaningfully formatted cells</a></li>
<li class="chapter" data-level="2.5" data-path="layered-formatting.html"><a href="layered-formatting.html"><i class="fa fa-check"></i><b>2.5</b> Layered meaningful formatting</a></li>
<li class="chapter" data-level="2.6" data-path="hierarchies-in-formatting.html"><a href="hierarchies-in-formatting.html"><i class="fa fa-check"></i><b>2.6</b> Hierarchies in formatting</a></li>
<li class="chapter" data-level="2.7" data-path="tidy-sentinel.html"><a href="tidy-sentinel.html"><i class="fa fa-check"></i><b>2.7</b> Sentinel values in non-text columns</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pivot.html"><a href="pivot.html"><i class="fa fa-check"></i><b>3</b> Pivot tables</a>
<ul>
<li class="chapter" data-level="3.1" data-path="pivot-simple.html"><a href="pivot-simple.html"><i class="fa fa-check"></i><b>3.1</b> Simple unpivoting</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="pivot-simple.html"><a href="pivot-simple.html#two-clear-rows-of-text-column-headers-left-aligned"><i class="fa fa-check"></i><b>3.1.1</b> Two clear rows of text column headers, left-aligned</a></li>
<li class="chapter" data-level="3.1.2" data-path="pivot-simple.html"><a href="pivot-simple.html#two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned"><i class="fa fa-check"></i><b>3.1.2</b> Two clear rows and columns of text headers, top-aligned and left-aligned</a></li>
<li class="chapter" data-level="3.1.3" data-path="pivot-simple.html"><a href="pivot-simple.html#multiple-rows-or-columns-of-headers-with-meaningful-formatting"><i class="fa fa-check"></i><b>3.1.3</b> Multiple rows or columns of headers, with meaningful formatting</a></li>
<li class="chapter" data-level="3.1.4" data-path="pivot-simple.html"><a href="pivot-simple.html#mixed-headers-and-notes-in-the-same-rowcolumn-distinguished-by-formatting"><i class="fa fa-check"></i><b>3.1.4</b> Mixed headers and notes in the same row/column, distinguished by formatting</a></li>
<li class="chapter" data-level="3.1.5" data-path="pivot-simple.html"><a href="pivot-simple.html#mixed-levels-of-headers-in-the-same-rowcolumn-distinguished-by-formatting"><i class="fa fa-check"></i><b>3.1.5</b> Mixed levels of headers in the same row/column, distinguished by formatting</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="pivot-complex.html"><a href="pivot-complex.html"><i class="fa fa-check"></i><b>3.2</b> Complex unpivoting</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="pivot-complex.html"><a href="pivot-complex.html#two-clear-rows-of-text-column-headers-left-aligned-1"><i class="fa fa-check"></i><b>3.2.1</b> Two clear rows of text column headers, left-aligned</a></li>
<li class="chapter" data-level="3.2.2" data-path="pivot-complex.html"><a href="pivot-complex.html#two-clear-columns-of-text-row-headers-top-aligned"><i class="fa fa-check"></i><b>3.2.2</b> Two clear columns of text row headers, top-aligned</a></li>
<li class="chapter" data-level="3.2.3" data-path="pivot-complex.html"><a href="pivot-complex.html#two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned-1"><i class="fa fa-check"></i><b>3.2.3</b> Two clear rows and columns of text headers, top-aligned and left-aligned</a></li>
<li class="chapter" data-level="3.2.4" data-path="pivot-complex.html"><a href="pivot-complex.html#centre-aligned-headers"><i class="fa fa-check"></i><b>3.2.4</b> Centre-aligned headers</a></li>
<li class="chapter" data-level="3.2.5" data-path="pivot-complex.html"><a href="pivot-complex.html#multiple-rows-or-columns-of-headers-with-meaningful-formatting-1"><i class="fa fa-check"></i><b>3.2.5</b> Multiple rows or columns of headers, with meaningful formatting</a></li>
<li class="chapter" data-level="3.2.6" data-path="pivot-complex.html"><a href="pivot-complex.html#mixed-headers-and-notes-in-the-same-rowcolumn-distinguished-by-formatting-1"><i class="fa fa-check"></i><b>3.2.6</b> Mixed headers and notes in the same row/column, distinguished by formatting</a></li>
<li class="chapter" data-level="3.2.7" data-path="pivot-complex.html"><a href="pivot-complex.html#mixed-levels-of-headers-in-the-same-rowcolumn-distinguished-by-formatting-1"><i class="fa fa-check"></i><b>3.2.7</b> Mixed levels of headers in the same row/column, distinguished by formatting</a></li>
<li class="chapter" data-level="3.2.8" data-path="pivot-complex.html"><a href="pivot-complex.html#repeated-rowscolumns-of-headers-within-the-table"><i class="fa fa-check"></i><b>3.2.8</b> Repeated rows/columns of headers within the table</a></li>
<li class="chapter" data-level="3.2.9" data-path="pivot-complex.html"><a href="pivot-complex.html#headers-amongst-the-data"><i class="fa fa-check"></i><b>3.2.9</b> Headers amongst the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="small-multiples.html"><a href="small-multiples.html"><i class="fa fa-check"></i><b>4</b> Small multiples</a>
<ul>
<li class="chapter" data-level="4.1" data-path="small-multiples-with-all-headers-present-for-each-multiple.html"><a href="small-multiples-with-all-headers-present-for-each-multiple.html"><i class="fa fa-check"></i><b>4.1</b> Small multiples with all headers present for each multiple</a></li>
<li class="chapter" data-level="4.2" data-path="same-table-in-several-worksheetsfiles-using-the-sheetfile-name.html"><a href="same-table-in-several-worksheetsfiles-using-the-sheetfile-name.html"><i class="fa fa-check"></i><b>4.2</b> Same table in several worksheets/files (using the sheet/file name)</a></li>
<li class="chapter" data-level="4.3" data-path="same-table-in-several-worksheetsfiles-but-in-different-positions.html"><a href="same-table-in-several-worksheetsfiles-but-in-different-positions.html"><i class="fa fa-check"></i><b>4.3</b> Same table in several worksheets/files but in different positions</a></li>
<li class="chapter" data-level="4.4" data-path="implied-multiples.html"><a href="implied-multiples.html"><i class="fa fa-check"></i><b>4.4</b> Implied multiples</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="formatting.html"><a href="formatting.html"><i class="fa fa-check"></i><b>5</b> Formatting</a>
<ul>
<li class="chapter" data-level="5.1" data-path="an-example-formatting-lookup.html"><a href="an-example-formatting-lookup.html"><i class="fa fa-check"></i><b>5.1</b> An example formatting lookup</a></li>
<li class="chapter" data-level="5.2" data-path="common-formats.html"><a href="common-formats.html"><i class="fa fa-check"></i><b>5.2</b> Common formats</a></li>
<li class="chapter" data-level="5.3" data-path="in-cell-formatting.html"><a href="in-cell-formatting.html"><i class="fa fa-check"></i><b>5.3</b> In-cell formatting</a></li>
<li class="chapter" data-level="5.4" data-path="multiple-pieces-of-information-in-a-single-cell-with-meaningful-formatting.html"><a href="multiple-pieces-of-information-in-a-single-cell-with-meaningful-formatting.html"><i class="fa fa-check"></i><b>5.4</b> Multiple pieces of information in a single cell, with meaningful formatting</a></li>
<li class="chapter" data-level="5.5" data-path="superscript-symbols.html"><a href="superscript-symbols.html"><i class="fa fa-check"></i><b>5.5</b> Superscript symbols</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-validation.html"><a href="data-validation.html"><i class="fa fa-check"></i><b>6</b> Data validation</a></li>
<li class="chapter" data-level="7" data-path="formulas.html"><a href="formulas.html"><i class="fa fa-check"></i><b>7</b> Formulas</a></li>
<li class="chapter" data-level="8" data-path="other-gotchas.html"><a href="other-gotchas.html"><i class="fa fa-check"></i><b>8</b> Other gotchas</a>
<ul>
<li class="chapter" data-level="8.1" data-path="non-text-headers-e-g-dates.html"><a href="non-text-headers-e-g-dates.html"><i class="fa fa-check"></i><b>8.1</b> Non-text headers e.g. dates</a></li>
<li class="chapter" data-level="8.2" data-path="data-embedded-in-comments.html"><a href="data-embedded-in-comments.html"><i class="fa fa-check"></i><b>8.2</b> Data embedded in comments</a></li>
<li class="chapter" data-level="8.3" data-path="named-ranges.html"><a href="named-ranges.html"><i class="fa fa-check"></i><b>8.3</b> Named ranges</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="case-studies.html"><a href="case-studies.html"><i class="fa fa-check"></i><b>9</b> Case studies</a>
<ul>
<li class="chapter" data-level="9.1" data-path="australian-marriage-survey.html"><a href="australian-marriage-survey.html"><i class="fa fa-check"></i><b>9.1</b> Australian Marriage Survey</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="australian-marriage-survey.html"><a href="australian-marriage-survey.html#the-full-code-listing"><i class="fa fa-check"></i><b>9.1.1</b> The full code listing</a></li>
<li class="chapter" data-level="9.1.2" data-path="australian-marriage-survey.html"><a href="australian-marriage-survey.html#step-by-step"><i class="fa fa-check"></i><b>9.1.2</b> Step by step</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="vaccinations.html"><a href="vaccinations.html"><i class="fa fa-check"></i><b>9.2</b> Vaccinations</a></li>
<li class="chapter" data-level="9.3" data-path="us-crime.html"><a href="us-crime.html"><i class="fa fa-check"></i><b>9.3</b> US Crime</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="us-crime.html"><a href="us-crime.html#us-crime-2"><i class="fa fa-check"></i><b>9.3.1</b> Table 2</a></li>
<li class="chapter" data-level="9.3.2" data-path="us-crime.html"><a href="us-crime.html#us-crime-3"><i class="fa fa-check"></i><b>9.3.2</b> Table 3</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="toronto-transit-commission.html"><a href="toronto-transit-commission.html"><i class="fa fa-check"></i><b>9.4</b> Toronto Transit Commission</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="toronto-transit-commission.html"><a href="toronto-transit-commission.html#the-full-code-listing-1"><i class="fa fa-check"></i><b>9.4.1</b> The full code listing</a></li>
<li class="chapter" data-level="9.4.2" data-path="toronto-transit-commission.html"><a href="toronto-transit-commission.html#step-by-step-1"><i class="fa fa-check"></i><b>9.4.2</b> Step by step</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="ground-water.html"><a href="ground-water.html"><i class="fa fa-check"></i><b>9.5</b> Ground water</a></li>
<li class="chapter" data-level="9.6" data-path="cashflows.html"><a href="cashflows.html"><i class="fa fa-check"></i><b>9.6</b> Cashflows</a></li>
<li class="chapter" data-level="9.7" data-path="school-performance.html"><a href="school-performance.html"><i class="fa fa-check"></i><b>9.7</b> School performance</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="school-performance.html"><a href="school-performance.html#sheet-1"><i class="fa fa-check"></i><b>9.7.1</b> Sheet 1</a></li>
<li class="chapter" data-level="9.7.2" data-path="school-performance.html"><a href="school-performance.html#sheet-2"><i class="fa fa-check"></i><b>9.7.2</b> Sheet 2</a></li>
<li class="chapter" data-level="9.7.3" data-path="school-performance.html"><a href="school-performance.html#sheet-3"><i class="fa fa-check"></i><b>9.7.3</b> Sheet 3</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spreadsheet Munging Strategies</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="us-crime" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> US Crime</h2>
<p><a href="https://twitter.com/albertocairo/status/963133927530483712"><img src="images/us-crime-tweet.jpg" alt="Tweet by Alberto Cairo about a spreadsheet that violates Hadley Wickham’s principles of tidy data" /></a></p>
<p>These are two tables of numbers of crimes in the USA, by state and category of
crime. Confusingly, they’re numbered Table 2 and Table 3. Table 1 exists but
isn’t included in this case study because it is so straightforward.</p>
<div id="us-crime-2" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Table 2</h3>
<p><img src="images/us-crime-2.jpg" /></p>
<p><a href="https://github.com/nacnudus/smungs/blob/master/inst/extdata/us-crime-2.xlsx?raw=true">Download the
file</a>.
<a href="https://ucr.fbi.gov/crime-in-the-u.s/2016/crime-in-the-u.s.-2016/tables/table-2">Original
source</a>.</p>
<div id="us-crime-2-simple" class="section level4" number="9.3.1.1">
<h4><span class="header-section-number">9.3.1.1</span> Simple version</h4>
<p>This is straightforward to import as long as you don’t care to organise the
hierarchies of crimes and areas. For example, Conneticut is within the division
New England, which itself is within the region Northeast, but if you don’t need
to express those relationships in the data then you can ignore the bold
formatting.</p>
<p>The only slight snag is that the header cells in row 5 are blank. There is a
header for the units “Rate per 100,000”, but no header for the units “Count” –
the cells in those positions are empty. It would be a problem if the cells
didn’t exist at all, because <code>behead("up", "unit")</code> wouldn’t be able to associate
data cells with missing header cells. Fortunately they do exist (because they
have formatting), they are just empty or <code>NA</code>. To make sure they aren’t
ignored, use <code>drop_na = FALSE</code> in <code>behead()</code>, and then later fill the blanks in
the <code>units</code> column with <code>"Count"</code>.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="us-crime.html#cb374-1"></a>cells &lt;-</span>
<span id="cb374-2"><a href="us-crime.html#cb374-2"></a><span class="st">  </span><span class="kw">xlsx_cells</span>(smungs<span class="op">::</span>us_crime_<span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb374-3"><a href="us-crime.html#cb374-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">map_chr</span>(character_formatted,</span>
<span id="cb374-4"><a href="us-crime.html#cb374-4"></a>                             <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.null</span>(.x), character, .x<span class="op">$</span>character[<span class="dv">1</span>])),</span>
<span id="cb374-5"><a href="us-crime.html#cb374-5"></a>         <span class="dt">character =</span> <span class="kw">str_replace_all</span>(character, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot; &quot;</span>))</span>
<span id="cb374-6"><a href="us-crime.html#cb374-6"></a></span>
<span id="cb374-7"><a href="us-crime.html#cb374-7"></a>cells <span class="op">%&gt;%</span></span>
<span id="cb374-8"><a href="us-crime.html#cb374-8"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>4L) <span class="op">%&gt;%</span></span>
<span id="cb374-9"><a href="us-crime.html#cb374-9"></a><span class="st">  </span><span class="kw">select</span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></span>
<span id="cb374-10"><a href="us-crime.html#cb374-10"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;up-left&quot;</span>, <span class="st">&quot;crime&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb374-11"><a href="us-crime.html#cb374-11"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;up&quot;</span>, <span class="st">&quot;unit&quot;</span>, <span class="dt">drop_na =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb374-12"><a href="us-crime.html#cb374-12"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left-up&quot;</span>, <span class="st">&quot;area&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb374-13"><a href="us-crime.html#cb374-13"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;year&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb374-14"><a href="us-crime.html#cb374-14"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;population&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb374-15"><a href="us-crime.html#cb374-15"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(year <span class="op">!=</span><span class="st"> &quot;Percent change&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb374-16"><a href="us-crime.html#cb374-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">unit =</span> <span class="kw">if_else</span>(unit <span class="op">==</span><span class="st"> &quot;&quot;</span>, <span class="st">&quot;Count&quot;</span>, unit)) <span class="op">%&gt;%</span></span>
<span id="cb374-17"><a href="us-crime.html#cb374-17"></a><span class="st">  </span><span class="kw">select</span>(row, data_type, numeric, unit, area, year, population, crime) <span class="op">%&gt;%</span></span>
<span id="cb374-18"><a href="us-crime.html#cb374-18"></a><span class="st">  </span><span class="kw">spatter</span>(unit) <span class="op">%&gt;%</span></span>
<span id="cb374-19"><a href="us-crime.html#cb374-19"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>row)</span></code></pre></div>
<pre><code>## # A tibble: 1,320 x 6
##    area         year  population crime                   Count `Rate per  100,0…
##    &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;                   &lt;dbl&gt;             &lt;dbl&gt;
##  1 United Stat… 2015  320896618  Aggravated assault     7.64e5             238. 
##  2 United Stat… 2015  320896618  Burglary               1.59e6             495. 
##  3 United Stat… 2015  320896618  Larceny-theft          5.72e6            1784. 
##  4 United Stat… 2015  320896618  Motor vehicle theft    7.13e5             222. 
##  5 United Stat… 2015  320896618  Murder and  nonneglig… 1.59e4               4.9
##  6 United Stat… 2015  320896618  Property crime         8.02e6            2500. 
##  7 United Stat… 2015  320896618  Rape (legacy definiti… 9.13e4              28.4
##  8 United Stat… 2015  320896618  Rape (revised definit… 1.26e5              39.3
##  9 United Stat… 2015  320896618  Robbery                3.28e5             102. 
## 10 United Stat… 2015  320896618  Violent crime          1.23e6             385. 
## # … with 1,310 more rows</code></pre>
</div>
<div id="us-crime-2-complex" class="section level4" number="9.3.1.2">
<h4><span class="header-section-number">9.3.1.2</span> Complex version</h4>
<p>If you do mind about grouping states within divisions within regions, and
crimes within categories, then you have more work to do using <code>enhead()</code> rather
than <code>behead()</code>.</p>
<ol style="list-style-type: decimal">
<li>Select the header cells at each level of the hierarchy and store them in
their own variables. For example, filter for the bold cells in row 4, which
are the categories of crimes, and store them in the <code>categories</code> variable.</li>
<li>Select the data cells, and use <code>enhead()</code> to join them to the headers.</li>
</ol>
<p>In fact the headers <code>unit</code>, <code>year</code>, <code>population</code> can be handled by <code>behead()</code>,
because they aren’t hierarchichal, so only the variables <code>category</code>, <code>crime</code>,
<code>region</code>, <code>division</code> and <code>state</code> are handled by <code>enhead()</code>.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="us-crime.html#cb376-1"></a>cells &lt;-</span>
<span id="cb376-2"><a href="us-crime.html#cb376-2"></a><span class="st">  </span><span class="kw">xlsx_cells</span>(smungs<span class="op">::</span>us_crime_<span class="dv">2</span>) <span class="op">%&gt;%</span></span>
<span id="cb376-3"><a href="us-crime.html#cb376-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">map_chr</span>(character_formatted,</span>
<span id="cb376-4"><a href="us-crime.html#cb376-4"></a>                             <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.null</span>(.x), character, .x<span class="op">$</span>character[<span class="dv">1</span>])),</span>
<span id="cb376-5"><a href="us-crime.html#cb376-5"></a>         <span class="dt">character =</span> <span class="kw">str_replace_all</span>(character, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot; &quot;</span>))</span>
<span id="cb376-6"><a href="us-crime.html#cb376-6"></a></span>
<span id="cb376-7"><a href="us-crime.html#cb376-7"></a>formats &lt;-<span class="st"> </span><span class="kw">xlsx_formats</span>(smungs<span class="op">::</span>us_crime_<span class="dv">2</span>)</span>
<span id="cb376-8"><a href="us-crime.html#cb376-8"></a></span>
<span id="cb376-9"><a href="us-crime.html#cb376-9"></a>categories &lt;-</span>
<span id="cb376-10"><a href="us-crime.html#cb376-10"></a><span class="st">  </span>cells <span class="op">%&gt;%</span></span>
<span id="cb376-11"><a href="us-crime.html#cb376-11"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">==</span><span class="st"> </span>4L,</span>
<span id="cb376-12"><a href="us-crime.html#cb376-12"></a>                data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>,</span>
<span id="cb376-13"><a href="us-crime.html#cb376-13"></a>                formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold[local_format_id]) <span class="op">%&gt;%</span></span>
<span id="cb376-14"><a href="us-crime.html#cb376-14"></a><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">category =</span> character)</span>
<span id="cb376-15"><a href="us-crime.html#cb376-15"></a>categories</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col category      
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;         
## 1     4     4 Violent crime 
## 2     4    16 Property crime</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="us-crime.html#cb378-1"></a>crimes &lt;-</span>
<span id="cb378-2"><a href="us-crime.html#cb378-2"></a><span class="st">  </span>cells <span class="op">%&gt;%</span></span>
<span id="cb378-3"><a href="us-crime.html#cb378-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">==</span><span class="st"> </span>4L, data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb378-4"><a href="us-crime.html#cb378-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">if_else</span>(character <span class="op">%in%</span><span class="st"> </span>categories<span class="op">$</span>category,</span>
<span id="cb378-5"><a href="us-crime.html#cb378-5"></a>                             <span class="st">&quot;Total&quot;</span>,</span>
<span id="cb378-6"><a href="us-crime.html#cb378-6"></a>                             character)) <span class="op">%&gt;%</span></span>
<span id="cb378-7"><a href="us-crime.html#cb378-7"></a><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">crime =</span> character)</span>
<span id="cb378-8"><a href="us-crime.html#cb378-8"></a>crimes</span></code></pre></div>
<pre><code>## # A tibble: 13 x 3
##      row   col crime                                 
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;                                 
##  1     4     1 Area                                  
##  2     4     2 Year                                  
##  3     4     3 Population                            
##  4     4     4 Total                                 
##  5     4     6 Murder and  nonnegligent  manslaughter
##  6     4     8 Rape (revised definition)             
##  7     4    10 Rape (legacy definition)              
##  8     4    12 Robbery                               
##  9     4    14 Aggravated assault                    
## 10     4    16 Total                                 
## 11     4    18 Burglary                              
## 12     4    20 Larceny-theft                         
## 13     4    22 Motor vehicle theft</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="us-crime.html#cb380-1"></a>regions &lt;-</span>
<span id="cb380-2"><a href="us-crime.html#cb380-2"></a><span class="st">  </span>cells <span class="op">%&gt;%</span></span>
<span id="cb380-3"><a href="us-crime.html#cb380-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>6L,</span>
<span id="cb380-4"><a href="us-crime.html#cb380-4"></a>                col <span class="op">==</span><span class="st"> </span>1L,</span>
<span id="cb380-5"><a href="us-crime.html#cb380-5"></a>                data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>,</span>
<span id="cb380-6"><a href="us-crime.html#cb380-6"></a>                formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold[local_format_id]) <span class="op">%&gt;%</span></span>
<span id="cb380-7"><a href="us-crime.html#cb380-7"></a><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">region =</span> character)</span>
<span id="cb380-8"><a href="us-crime.html#cb380-8"></a>regions</span></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##     row   col region             
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              
## 1     6     1 United States Total
## 2     9     1 Northeast          
## 3    45     1 Midwest            
## 4    90     1 South              
## 5   153     1 West</code></pre>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="us-crime.html#cb382-1"></a>divisions &lt;-</span>
<span id="cb382-2"><a href="us-crime.html#cb382-2"></a><span class="st">  </span>cells <span class="op">%&gt;%</span></span>
<span id="cb382-3"><a href="us-crime.html#cb382-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>6L,</span>
<span id="cb382-4"><a href="us-crime.html#cb382-4"></a>                col <span class="op">==</span><span class="st"> </span>1L,</span>
<span id="cb382-5"><a href="us-crime.html#cb382-5"></a>                data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>,</span>
<span id="cb382-6"><a href="us-crime.html#cb382-6"></a>                <span class="op">!</span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold[local_format_id],</span>
<span id="cb382-7"><a href="us-crime.html#cb382-7"></a>                <span class="op">!</span><span class="kw">str_detect</span>(character, <span class="st">&quot;^ {5}&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb382-8"><a href="us-crime.html#cb382-8"></a><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">division =</span> character)</span>
<span id="cb382-9"><a href="us-crime.html#cb382-9"></a>divisions</span></code></pre></div>
<pre><code>## # A tibble: 21 x 3
##      row   col division          
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;             
##  1    12     1 New England       
##  2    33     1 Middle Atlantic   
##  3    48     1 East North Central
##  4    66     1 West North Central
##  5    93     1 South Atlantic    
##  6   123     1 East South Central
##  7   138     1 West South Central
##  8   156     1 Mountain          
##  9   183     1 Pacific           
## 10   201     1 Puerto Rico       
## # … with 11 more rows</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="us-crime.html#cb384-1"></a>states &lt;-</span>
<span id="cb384-2"><a href="us-crime.html#cb384-2"></a><span class="st">  </span>cells <span class="op">%&gt;%</span></span>
<span id="cb384-3"><a href="us-crime.html#cb384-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>6L,</span>
<span id="cb384-4"><a href="us-crime.html#cb384-4"></a>                col <span class="op">==</span><span class="st"> </span>1L,</span>
<span id="cb384-5"><a href="us-crime.html#cb384-5"></a>                data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb384-6"><a href="us-crime.html#cb384-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">if_else</span>(<span class="kw">str_detect</span>(character, <span class="st">&quot;^ {5}&quot;</span>),</span>
<span id="cb384-7"><a href="us-crime.html#cb384-7"></a>                             <span class="kw">str_trim</span>(character),</span>
<span id="cb384-8"><a href="us-crime.html#cb384-8"></a>                             <span class="st">&quot;Total&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb384-9"><a href="us-crime.html#cb384-9"></a><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">state =</span> character)</span>
<span id="cb384-10"><a href="us-crime.html#cb384-10"></a>states</span></code></pre></div>
<pre><code>## # A tibble: 77 x 3
##      row   col state        
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;        
##  1     6     1 Total        
##  2     9     1 Total        
##  3    12     1 Total        
##  4    15     1 Connecticut  
##  5    18     1 Maine        
##  6    21     1 Massachusetts
##  7    24     1 New Hampshire
##  8    27     1 Rhode Island 
##  9    30     1 Vermont      
## 10    33     1 Total        
## # … with 67 more rows</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="us-crime.html#cb386-1"></a>cells <span class="op">%&gt;%</span></span>
<span id="cb386-2"><a href="us-crime.html#cb386-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>5L, col <span class="op">&gt;=</span><span class="st"> </span>2L) <span class="op">%&gt;%</span></span>
<span id="cb386-3"><a href="us-crime.html#cb386-3"></a><span class="st">  </span><span class="kw">select</span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></span>
<span id="cb386-4"><a href="us-crime.html#cb386-4"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;up&quot;</span>, <span class="st">&quot;unit&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb386-5"><a href="us-crime.html#cb386-5"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;year&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb386-6"><a href="us-crime.html#cb386-6"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;population&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb386-7"><a href="us-crime.html#cb386-7"></a><span class="st">  </span><span class="kw">enhead</span>(categories, <span class="st">&quot;up-left&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb386-8"><a href="us-crime.html#cb386-8"></a><span class="st">  </span><span class="kw">enhead</span>(crimes, <span class="st">&quot;up-left&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb386-9"><a href="us-crime.html#cb386-9"></a><span class="st">  </span><span class="kw">enhead</span>(regions, <span class="st">&quot;left-up&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb386-10"><a href="us-crime.html#cb386-10"></a><span class="st">  </span><span class="kw">enhead</span>(divisions, <span class="st">&quot;left-up&quot;</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb386-11"><a href="us-crime.html#cb386-11"></a><span class="st">  </span><span class="kw">enhead</span>(states, <span class="st">&quot;left-up&quot;</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb386-12"><a href="us-crime.html#cb386-12"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(year <span class="op">!=</span><span class="st"> &quot;Percent change&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb386-13"><a href="us-crime.html#cb386-13"></a><span class="st">  </span><span class="kw">select</span>(<span class="dt">value =</span> numeric, category, crime, region, division, state, year, population)</span></code></pre></div>
<pre><code>## # A tibble: 2,640 x 8
##      value category   crime             region  division  state year  population
##      &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;             &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     
##  1 42121   Violent c… Total             Northe… New Engl… Total 2015  14710229  
##  2   286.  Violent c… Total             Northe… New Engl… Total 2015  14710229  
##  3 41598   Violent c… Total             Northe… New Engl… Total 2016  14735525  
##  4   282.  Violent c… Total             Northe… New Engl… Total 2016  14735525  
##  5   326   Violent c… Murder and  nonn… Northe… New Engl… Total 2015  14710229  
##  6     2.2 Violent c… Murder and  nonn… Northe… New Engl… Total 2015  14710229  
##  7   292   Violent c… Murder and  nonn… Northe… New Engl… Total 2016  14735525  
##  8     2   Violent c… Murder and  nonn… Northe… New Engl… Total 2016  14735525  
##  9  4602   Violent c… Rape (revised de… Northe… New Engl… Total 2015  14710229  
## 10    31.3 Violent c… Rape (revised de… Northe… New Engl… Total 2015  14710229  
## # … with 2,630 more rows</code></pre>
</div>
</div>
<div id="us-crime-3" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Table 3</h3>
<p><img src="images/us-crime-3.jpg" /></p>
<p><a href="https://github.com/nacnudus/smungs/blob/master/inst/extdata/us-crime-3.xlsx?raw=true">Download the
file</a>.
<a href="https://ucr.fbi.gov/crime-in-the-u.s/2016/crime-in-the-u.s.-2016/tables/table-3">Original
source</a>.</p>
<p>This table is confusing to humans, let alone computers. The <code>Population</code> column
seems to belong to a different table altogether, so that’s how we’ll treat it.</p>
<ol style="list-style-type: decimal">
<li>Import the <code>Population</code> column and the state/area headers to the left.</li>
<li>Import the crime-related column headers, and the state/area headers to the left.</li>
<li>Join the two datasets.</li>
</ol>
<p>The <code>statistic</code> header ends up having blank values due to the cells being blank,
so these are manually filled in.</p>
<p>The hierarchy of crime (e.g. ‘robbery’ is within ‘violent crime’) is ignored.
That would be handled in the same way as for <a href="us-crime.html#us-crime-2">Table 2</a>.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="us-crime.html#cb388-1"></a>cells &lt;-</span>
<span id="cb388-2"><a href="us-crime.html#cb388-2"></a><span class="st">  </span><span class="kw">xlsx_cells</span>(smungs<span class="op">::</span>us_crime_<span class="dv">3</span>) <span class="op">%&gt;%</span></span>
<span id="cb388-3"><a href="us-crime.html#cb388-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">map_chr</span>(character_formatted,</span>
<span id="cb388-4"><a href="us-crime.html#cb388-4"></a>                             <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.null</span>(.x), character, .x<span class="op">$</span>character[<span class="dv">1</span>])),</span>
<span id="cb388-5"><a href="us-crime.html#cb388-5"></a>         <span class="dt">character =</span> <span class="kw">str_replace_all</span>(character, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot; &quot;</span>))</span>
<span id="cb388-6"><a href="us-crime.html#cb388-6"></a></span>
<span id="cb388-7"><a href="us-crime.html#cb388-7"></a>population &lt;-</span>
<span id="cb388-8"><a href="us-crime.html#cb388-8"></a><span class="st">  </span>cells <span class="op">%&gt;%</span></span>
<span id="cb388-9"><a href="us-crime.html#cb388-9"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>5L, col <span class="op">&lt;=</span><span class="st"> </span>4L) <span class="op">%&gt;%</span></span>
<span id="cb388-10"><a href="us-crime.html#cb388-10"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left-up&quot;</span>, <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb388-11"><a href="us-crime.html#cb388-11"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left-up&quot;</span>, <span class="st">&quot;area&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb388-12"><a href="us-crime.html#cb388-12"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;statistic&quot;</span>, <span class="dt">drop_na =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></span>
<span id="cb388-13"><a href="us-crime.html#cb388-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">statistic =</span> <span class="kw">case_when</span>(<span class="kw">is.na</span>(statistic) <span class="op">~</span><span class="st"> &quot;Population&quot;</span>,</span>
<span id="cb388-14"><a href="us-crime.html#cb388-14"></a>                               statistic <span class="op">==</span><span class="st"> &quot;&quot;</span> <span class="op">~</span><span class="st"> &quot;Population&quot;</span>,</span>
<span id="cb388-15"><a href="us-crime.html#cb388-15"></a>                               <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">str_trim</span>(statistic))) <span class="op">%&gt;%</span></span>
<span id="cb388-16"><a href="us-crime.html#cb388-16"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(data_type <span class="op">==</span><span class="st"> &quot;numeric&quot;</span>,</span>
<span id="cb388-17"><a href="us-crime.html#cb388-17"></a>                <span class="op">!</span><span class="kw">str_detect</span>(area, <span class="kw">regex</span>(<span class="st">&quot;total&quot;</span>, <span class="dt">ignore_case =</span> <span class="ot">TRUE</span>)),</span>
<span id="cb388-18"><a href="us-crime.html#cb388-18"></a>                statistic <span class="op">!=</span><span class="st"> &quot;Estimated total&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb388-19"><a href="us-crime.html#cb388-19"></a><span class="st">  </span><span class="kw">select</span>(data_type, numeric, state, area, statistic) <span class="op">%&gt;%</span></span>
<span id="cb388-20"><a href="us-crime.html#cb388-20"></a><span class="st">  </span><span class="kw">spatter</span>(statistic)</span>
<span id="cb388-21"><a href="us-crime.html#cb388-21"></a></span>
<span id="cb388-22"><a href="us-crime.html#cb388-22"></a>crime &lt;-</span>
<span id="cb388-23"><a href="us-crime.html#cb388-23"></a><span class="st">  </span>cells <span class="op">%&gt;%</span></span>
<span id="cb388-24"><a href="us-crime.html#cb388-24"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>, col <span class="op">!=</span><span class="st"> </span>5L) <span class="op">%&gt;%</span></span>
<span id="cb388-25"><a href="us-crime.html#cb388-25"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left-up&quot;</span>, <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb388-26"><a href="us-crime.html#cb388-26"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left-up&quot;</span>, <span class="st">&quot;area&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb388-27"><a href="us-crime.html#cb388-27"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;statistic&quot;</span>, <span class="dt">formatters =</span> <span class="kw">list</span>(<span class="dt">character =</span> str_trim)) <span class="op">%&gt;%</span></span>
<span id="cb388-28"><a href="us-crime.html#cb388-28"></a><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;up&quot;</span>, <span class="st">&quot;crime&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb388-29"><a href="us-crime.html#cb388-29"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(data_type <span class="op">==</span><span class="st"> &quot;numeric&quot;</span>,</span>
<span id="cb388-30"><a href="us-crime.html#cb388-30"></a>                <span class="op">!</span><span class="kw">str_detect</span>(area, <span class="kw">regex</span>(<span class="st">&quot;total&quot;</span>, <span class="dt">ignore_case =</span> <span class="ot">TRUE</span>)),</span>
<span id="cb388-31"><a href="us-crime.html#cb388-31"></a>                <span class="op">!</span><span class="kw">is.na</span>(statistic),</span>
<span id="cb388-32"><a href="us-crime.html#cb388-32"></a>                statistic <span class="op">!=</span><span class="st"> &quot;&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb388-33"><a href="us-crime.html#cb388-33"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">statistic =</span> <span class="kw">case_when</span>(statistic <span class="op">==</span><span class="st"> &quot;Area actually reporting&quot;</span> <span class="op">~</span><span class="st"> &quot;Actual&quot;</span>,</span>
<span id="cb388-34"><a href="us-crime.html#cb388-34"></a>                               statistic <span class="op">==</span><span class="st"> &quot;Estimated total&quot;</span> <span class="op">~</span><span class="st"> &quot;Estimated&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb388-35"><a href="us-crime.html#cb388-35"></a><span class="st">  </span><span class="kw">select</span>(data_type, numeric, state, area, statistic, crime) <span class="op">%&gt;%</span></span>
<span id="cb388-36"><a href="us-crime.html#cb388-36"></a><span class="st">  </span><span class="kw">spatter</span>(statistic)</span>
<span id="cb388-37"><a href="us-crime.html#cb388-37"></a></span>
<span id="cb388-38"><a href="us-crime.html#cb388-38"></a><span class="kw">left_join</span>(population, crime)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;state&quot;, &quot;area&quot;)</code></pre>
<pre><code>## # A tibble: 1,480 x 7
##    state  area        `Area actually r… Population crime        Actual Estimated
##    &lt;chr&gt;  &lt;chr&gt;                   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;
##  1 ALABA… Cities out…             0.966     520422 Aggravated… 2.84e+3      2914
##  2 ALABA… Cities out…             0.966     520422 Burglary    4.17e+3      4275
##  3 ALABA… Cities out…             0.966     520422 Larceny- t… 1.43e+4     14641
##  4 ALABA… Cities out…             0.966     520422 Motor  veh… 1.34e+3      1375
##  5 ALABA… Cities out…             0.966     520422 Murder and… 4.10e+1        42
##  6 ALABA… Cities out…             0.966     520422 Population  9.66e-1         1
##  7 ALABA… Cities out…             0.966     520422 Property  … 1.98e+4     20291
##  8 ALABA… Cities out…             0.966     520422 Rape (lega… 1.87e+2       193
##  9 ALABA… Cities out…             0.966     520422 Rape (revi… 2.63e+2       269
## 10 ALABA… Cities out…             0.966     520422 Robbery     4.10e+2       421
## # … with 1,470 more rows</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="vaccinations.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="toronto-transit-commission.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"],
"google": true,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nacnudus/spreadsheet-munging-strategies/edit/master/case-studies.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["spreadsheet-munging-strategies.pdf", "spreadsheet-munging-strategies.epub"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
